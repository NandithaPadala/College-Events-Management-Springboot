<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
	<meta charset="UTF-8">
	<title>Manage Users | Admin Panel</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" th:href="@{/css/styles.css}">
</head>

<body class="bg-light">
	<div class="container mt-5">
		<div class="text-center mb-4">
			<h2 class="fw-bold">Manage Users</h2>
			<p class="text-muted">Search, filter, and manage user roles and account status.</p>
		</div>

		<!-- Flash Messages -->
		<div th:if="${successMessage}" class="alert alert-success text-center" th:text="${successMessage}"></div>
		<div th:if="${errorMessage}" class="alert alert-danger text-center" th:text="${errorMessage}"></div>

		<!-- Search & Filter -->
		<form class="row g-3 mb-4" th:action="@{/admin/users/manage}" method="get">
			<div class="col-md-4">
				<label class="form-label fw-semibold">Search</label>
				<input type="text" name="searchQuery" th:value="${searchQuery}" class="form-control"
					placeholder="Search by name or email">
			</div>
			<div class="col-md-4">
				<label class="form-label fw-semibold">Filter by Role</label>
				<select name="role" class="form-select">
					<option value="">All Roles</option>
					<option value="ADMIN" th:selected="${selectedRole == 'ADMIN'}">Admin</option>
					<option value="STUDENT" th:selected="${selectedRole == 'STUDENT'}">User</option>
				</select>
			</div>
			<div class="col-md-4 d-flex align-items-end">
				<button type="submit" class="btn btn-primary px-4 me-2">Search</button>
				<a th:href="@{/admin/users}" class="btn btn-secondary px-4">Reset</a>
			</div>
		</form>

		<!-- Users Table -->
		<div class="card shadow-sm rounded-4">
			<div class="card-body">
				<table class="table table-hover align-middle">
					<thead class="table-light">
						<tr>
							<th>ID</th>
							<th>Full Name</th>
							<th>Email</th>
							<th>Role</th>
							<!--
                            <th>Status</th>
                            <th class="text-center">Actions</th>
							-->
						</tr>
					</thead>
					<tbody>
						<tr th:each="user : ${users}">
							<td th:text="${user.id}"></td>
							<td th:text="${user.fullName}"></td>
							<td th:text="${user.email}"></td>
							<td>
								<form th:action="@{'/admin/users/' + ${user.id} + '/role'}" method="post"
									class="d-inline">
									<select name="role" class="form-select form-select-sm d-inline w-auto">
										<option value="STUDENT" th:selected="${user.role == 'STUDENT'}">User</option>
										<option value="ADMIN" th:selected="${user.role == 'ADMIN'}">Admin</option>
									</select>
									<button type="submit" class="btn btn-outline-success btn-sm ms-2">Update</button>
								</form>
							</td>
							<!--
                            <td>
                                <span class="badge"
                                      th:classappend="${user.active ? 'bg-success' : 'bg-danger'}"
                                      th:text="${user.active ? 'Active' : 'Inactive'}"></span>
                            </td>
                            <td class="text-center">
                                <form th:action="@{'/admin/users/' + ${user.id} + '/status'}" method="post">
                                    <button type="submit"
                                            th:classappend="${user.active ? 'btn btn-danger btn-sm' : 'btn btn-success btn-sm'}"
                                            th:text="${user.active ? 'Deactivate' : 'Activate'}"></button>
                                </form>
                            </td>
							-->
						</tr>
					</tbody>
				</table>

				<div th:if="${#lists.isEmpty(users)}" class="text-center text-muted mt-3">
					No users found.
				</div>
			</div>
		</div>

		<!-- Back Button -->
		<div class="text-center mt-4">
			<a th:href="@{/admin/dashboard}" class="btn btn-gradient-primary btn-lg">
				<i class="fas fa-arrow-left me-2"></i> Back to Dashboard
			</a>
			<a th:href="@{/}" class="btn btn-gradient-primary btn-lg">
				<i class="fas fa-arrow-left me-2"></i> Back to Home
			</a>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://kit.fontawesome.com/a2e0b6b64b.js" crossorigin="anonymous"></script>
</body>

</html>