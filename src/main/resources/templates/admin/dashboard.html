<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>Admin Dashboard</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
	<link rel="stylesheet" th:href="@{/css/styles.css}">
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="bg-light">
	<div class="container my-5">

		<!-- Header -->
		<div class="text-center mb-5">
			<h2 class="fw-bold" style="color:black">
				Admin Dashboard
			</h2>
			<p class="text-muted">Manage events, users, and registrations efficiently.</p>
		</div>

		<!-- Stats Summary Cards -->
		<div class="row g-4 mb-5">
			<div class="col-md-3" th:each="entry : ${stats}">
				<div class="card gradient-border text-center animate-fade-in-up">

					<div class="card-body">
						<h5 class="card-title fw-semibold"
							th:text="${#strings.capitalize(entry.key.replaceAll('([A-Z])', ' $1'))}"></h5>

						<h3 class="card-text fw-bold" style="color: purple" th:text="${entry.value}">
						</h3>
					</div>
				</div>
			</div>
		</div>

		<!-- Charts Section -->
		<div class="row mb-5">
			<div class="col-md-6">
				<div class="card gradient-border animate-fade-in-up">
					<div class="card-body">
						<h5 class="card-title fw-semibold text-center">Registration Status Overview</h5>
						<canvas id="registrationChart"></canvas>
					</div>
				</div>
			</div>

			<div class="col-md-6">
				<div class="card gradient-border animate-fade-in-up">
					<div class="card-body">
						<h5 class="card-title fw-semibold text-center">User Roles Distribution</h5>
						<canvas id="userChart"></canvas>
					</div>
				</div>
			</div>
		</div>

		<!-- Past Events -->
		<div class="card gradient-border mb-4 animate-fade-in-up">
			<div class="card-body">
				<h5 class="card-title fw-bold">Past Events</h5>
				<table class="table table-hover align-middle">
					<thead>
						<tr>
							<th>Event Name</th>
							<th>Date</th>
							<th>Created By</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="event : ${recentEvents}">
							<td th:text="${event.title}"></td>
							<td th:text="${#temporals.format(event.eventDate, 'dd MMM yyyy')}"></td>
							<td th:text="${event.createdBy.fullName}"></td>
						</tr>
						<tr th:if="${#lists.isEmpty(recentEvents)}">
							<td colspan="3" class="text-center text-muted">No past events found</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<!-- Recent Registrations -->
		<div class="card gradient-border mb-4 animate-fade-in-up">
			<div class="card-body">
				<h5 class="card-title fw-bold">Recent Registrations</h5>
				<table class="table table-hover align-middle">
					<thead>
						<tr>
							<th>User</th>
							<th>Event</th>
							<th>Status</th>
							<th>Date</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="r : ${recentRegistrations}">
							<td th:text="${r.user.fullName}"></td>
							<td th:text="${r.event.title}"></td>
							<td>
								<span th:switch="${r.status}">
									<span th:case="'APPROVED'" class="badge bg-success" th:text="${r.status}"></span>
									<span th:case="'PENDING'" class="badge bg-warning text-dark"
										th:text="${r.status}"></span>
									<span th:case="*" class="badge bg-danger" th:text="${r.status}"></span>
								</span>


							</td>
							<td th:text="${#temporals.format(r.registrationDate, 'dd MMM yyyy')}"></td>
						</tr>
						<tr th:if="${#lists.isEmpty(recentRegistrations)}">
							<td colspan="4" class="text-center text-muted">No recent registrations yet</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<!-- Pending Approvals -->
		<div class="card gradient-border mb-5 animate-fade-in-up">
			<div class="card-body">
				<h5 class="card-title fw-bold">Pending Approvals</h5>
				<table class="table table-bordered align-middle">
					<thead>
						<tr>
							<th>User</th>
							<th>Event</th>
							<th>Status</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="reg : ${pendingApprovals}">
							<td th:text="${reg.user.fullName}"></td>
							<td th:text="${reg.event.title}"></td>
							<td th:text="${reg.status}"></td>
						</tr>
						<tr th:if="${#lists.isEmpty(pendingApprovals)}">
							<td colspan="3" class="text-center text-muted">No pending approvals ðŸŽ‰</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>

		<!-- Back Button -->
		<div class="text-center mt-5">
			<a th:href="@{/events}" class="btn btn-gradient-primary btn-lg">
				<i class="fas fa-arrow-left me-2"></i> Back to Events
			</a>
		</div>
	</div>

	<!-- Chart.js -->
	<script th:inline="javascript">
		const registrationData = {
			labels: ['Pending', 'Approved', 'Rejected'],
			datasets: [{
				label: 'Registrations',
				data: [
					[[${stats.pendingRegistrations}]],
					[[${stats.approvedRegistrations}]],
					[[${stats.rejectedRegistrations}]]
				],
				backgroundColor: ['#FBBF24', '#10B981', '#EF4444']
			}]
		};
		new Chart(document.getElementById('registrationChart'), {
			type: 'pie',
			data: registrationData
		});

		const userData = {
			labels: ['Students', 'Admins'],
			datasets: [{
				label: 'Users',
				data: [
					[[${stats.totalStudents}]],
					[[${stats.totalAdmins}]]
				],
				backgroundColor: ['#3B82F6', '#7C3AED']
			}]
		};
		new Chart(document.getElementById('userChart'), {
			type: 'doughnut',
			data: userData
		});
	</script>
</body>

</html>