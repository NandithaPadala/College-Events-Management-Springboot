<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
	<meta charset="UTF-8">
	<title>Manage Registrations | Admin Panel</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" th:href="@{/css/styles.css}">
</head>

<body class="bg-light">
	<div class="container mt-5">
		<div class="text-center mb-4">
			<h2 class="fw-bold">Manage Registrations</h2>
			<p class="text-muted">View and filter user registrations by event, status, or department.</p>
		</div>

		<!-- Flash Messages -->
		<div th:if="${successMessage}" class="alert alert-success text-center" th:text="${successMessage}"></div>
		<div th:if="${errorMessage}" class="alert alert-danger text-center" th:text="${errorMessage}"></div>

		<!-- Filters -->
		<form class="row g-3 mb-4" th:action="@{/admin/registrations/manage}" method="get">
			<div class="col-md-4">
				<label class="form-label fw-semibold">Event</label>
				<select name="eventId" class="form-select">
					<option value="">All Events</option>
					<option th:each="event : ${events}" th:value="${event.id}" th:text="${event.title}"></option>
				</select>
			</div>
			<div class="col-md-4">
				<label class="form-label fw-semibold">Status</label>
				<select name="status" class="form-select">
					<option value="">All</option>
					<option value="PENDING">Pending</option>
					<option value="APPROVED">Approved</option>
					<option value="REJECTED">Rejected</option>
				</select>
			</div>
			<div class="col-md-4">
				<label class="form-label fw-semibold">Department</label>
				<select name="department" class="form-select">
					<option value="">All Departments</option>
					<option th:each="dept : ${departments}" th:value="${dept}" th:text="${dept}"></option>
				</select>
			</div>
			<div class="col-12 text-center mt-3">
				<button type="submit" class="btn btn-primary px-4">Filter</button>
				<a th:href="@{/admin/registrations/manage}" class="btn btn-secondary px-4">Reset</a>
			</div>
		</form>

		<!-- Table -->
		<div class="card shadow-sm rounded-4">
			<div class="card-body">
				<table class="table table-hover align-middle">
					<thead class="table-light">
						<tr>
							<th>ID</th>
							<th>User</th>
							<th>Event</th>
							<th>Department</th>
							<th>Status</th>
							<th>Date Registered</th>
						</tr>
					</thead>
					<tbody>
						<tr th:each="reg : ${registrations}">
							<td th:text="${reg.id}"></td>
							<td th:text="${reg.user.fullName}"></td>
							<td th:text="${reg.event.title}"></td>
							<td th:text="${reg.user.department}"></td>
							<td>
								<span class="badge"
									th:classappend="${reg.status == 'APPROVED' ? 'bg-success' :
                                                      (reg.status == 'REJECTED' ? 'bg-danger' : 'bg-warning text-dark')}"
									th:text="${reg.status}"></span>
							</td>
							<td th:text="${#temporals.format(reg.createdAt, 'dd MMM yyyy HH:mm')}"></td>
						</tr>
					</tbody>
				</table>

				<div th:if="${#lists.isEmpty(registrations)}" class="text-center text-muted mt-3">
					No registrations found.
				</div>
			</div>
		</div>

		<!-- Back Button -->
		<div class="text-center mt-4">
			<a th:href="@{/admin/dashboard}" class="btn btn-gradient-primary btn-lg">
				<i class="fas fa-arrow-left me-2"></i> Back to Dashboard
			</a>
			<a th:href="@{/}" class="btn btn-gradient-primary btn-lg">
				<i class="fas fa-arrow-left me-2"></i> Back to Home
			</a>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://kit.fontawesome.com/a2e0b6b64b.js" crossorigin="anonymous"></script>
</body>

</html>